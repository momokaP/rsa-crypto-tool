<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RSA ν‚¤ μƒμ„± λ° λ€μΉ­ν‚¤ μ•”λ³µνΈν™” λ„κµ¬</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 50%, #f3e8ff 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .header {
      text-align: center;
      padding: 40px 0;
    }

    .header-icon {
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }

    .header p {
      color: #6b7280;
      font-size: 1.1rem;
    }

    .card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      margin-bottom: 30px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card-header {
      padding: 20px 30px;
      color: white;
      font-weight: 600;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-header.blue {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
    }

    .card-header.green {
      background: linear-gradient(135deg, #10b981, #059669);
    }

    .card-header.purple {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    }

    .card-content {
      padding: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #374151;
      font-size: 0.9rem;
    }

    .input-wrapper {
      position: relative;
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.2s;
      background: white;
    }

    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-textarea {
      resize: vertical;
      font-family: 'Courier New', monospace;
    }

    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      color: #6b7280;
      padding: 4px;
    }

    .password-toggle:hover {
      color: #374151;
    }

    .btn {
      width: 100%;
      padding: 14px 20px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .btn-success:hover {
      background: linear-gradient(135deg, #059669, #047857);
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
    }

    .btn-purple {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
    }

    .btn-purple:hover {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
    }

    .output-section {
      margin-top: 25px;
    }

    .output-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 10px;
    }

    .output-label {
      font-weight: 500;
      font-size: 0.9rem;
    }

    .output-label.green { color: #059669; }
    .output-label.red { color: #dc2626; }
    .output-label.purple { color: #7c3aed; }

    .copy-btn {
      padding: 6px 12px;
      border: 1px solid;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s;
    }

    .copy-btn.green {
      color: #059669;
      border-color: #bbf7d0;
    }

    .copy-btn.green:hover {
      background: #f0fdf4;
    }

    .copy-btn.red {
      color: #dc2626;
      border-color: #fecaca;
    }

    .copy-btn.red:hover {
      background: #fef2f2;
    }

    .copy-btn.purple {
      color: #7c3aed;
      border-color: #ddd6fe;
    }

    .copy-btn.purple:hover {
      background: #faf5ff;
    }

    .output-box {
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      max-height: 160px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
      line-height: 1.4;
    }

    .output-box.green {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #166534;
    }

    .output-box.red {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #991b1b;
    }

    .output-box.purple {
      background: #faf5ff;
      border: 1px solid #ddd6fe;
      color: #581c87;
    }

    .description {
      color: #6b7280;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .footer {
      text-align: center;
      padding: 40px 0;
      color: #6b7280;
      font-size: 0.9rem;
    }

    .icon {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .icon-sm {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 10px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .card-content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ν—¤λ” -->
    <div class="header">
      <div class="header-icon">
        <svg class="icon" viewBox="0 0 24 24" fill="white">
          <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
        </svg>
      </div>
      <h1>RSA μ•”νΈν™” λ„κµ¬</h1>
      <p>μ•μ „ν• ν‚¤ μƒμ„± λ° λ€μΉ­ν‚¤ μ•”λ³µνΈν™”</p>
    </div>

    <!-- RSA ν‚¤ μƒμ„±κΈ° -->
    <div class="card">
      <div class="card-header blue">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31.84 2.41 2 2.83V22h2v-2.17c1.16-.42 2-1.52 2-2.83 0-1.66-1.34-3-3-3zM7 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12.5-9c-.83 0-1.5.67-1.5 1.5v2c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-2c0-.83-.67-1.5-1.5-1.5zm-1-4C17.33 5 16 6.34 16 8v1h1V8c0-.55.45-1 1-1s1 .45 1 1v1h1V8c0-1.66-1.34-3-3-3z"/>
        </svg>
        RSA ν‚¤ μƒμ„±κΈ°
      </div>
      <div class="card-content">
        <p class="description">λΉ„λ°€λ²νΈλ¥Ό μ…λ ¥ν•΄ κ°μΈν‚¤λ¥Ό μ•”νΈν™”ν•κ³ , κ³µκ°ν‚¤μ™€ ν•¨κ» μ €μ¥ν•μ„Έμ”.</p>
        
        <div class="form-group">
          <label class="form-label" for="genPassword">
            <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor" style="display: inline; margin-right: 6px;">
              <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
            </svg>
            κ°μΈν‚¤ μ•”νΈν™”μ© λΉ„λ°€λ²νΈ
          </label>
          <div class="input-wrapper">
            <input type="password" id="genPassword" class="form-input" placeholder="λΉ„λ°€λ²νΈ μ…λ ¥" />
            <button type="button" class="password-toggle" onclick="togglePassword('genPassword')">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
            </button>
          </div>
        </div>

        <button class="btn btn-primary" onclick="generateKeyPair()">
          <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
            <path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31.84 2.41 2 2.83V22h2v-2.17c1.16-.42 2-1.52 2-2.83 0-1.66-1.34-3-3-3zM7 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12.5-9c-.83 0-1.5.67-1.5 1.5v2c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-2c0-.83-.67-1.5-1.5-1.5zm-1-4C17.33 5 16 6.34 16 8v1h1V8c0-.55.45-1 1-1s1 .45 1 1v1h1V8c0-1.66-1.34-3-3-3z"/>
          </svg>
          ν‚¤ μ μƒμ„±
        </button>

        <div class="output-section" id="keyGenOutput" style="display: none;">
          <div class="output-header">
            <span class="output-label green">κ³µκ°ν‚¤ (Public Key)</span>
            <button class="copy-btn green" onclick="copyToClipboard('publicKeyPem')">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
              λ³µμ‚¬
            </button>
          </div>
          <pre class="output-box green" id="publicKeyPem"></pre>

          <div class="output-header" style="margin-top: 20px;">
            <span class="output-label red">μ•”νΈν™”λ κ°μΈν‚¤ (Encrypted Private Key)</span>
            <button class="copy-btn red" onclick="copyToClipboard('encryptedPrivateKey')">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
              λ³µμ‚¬
            </button>
          </div>
          <pre class="output-box red" id="encryptedPrivateKey"></pre>
        </div>
      </div>
    </div>

    <!-- λ€μΉ­ν‚¤ μ•”νΈν™” -->
    <div class="card">
      <div class="card-header green">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
        </svg>
        λ€μΉ­ν‚¤(λΉ„λ°€ν‚¤) μ•”νΈν™”
      </div>
      <div class="card-content">
        <p class="description">μ•”νΈν™”ν•  λ€μΉ­ν‚¤(λΉ„λ°€ν‚¤)λ¥Ό μ…λ ¥ν•κ³ , κ³µκ°ν‚¤(PEM)λ΅ μ•”νΈν™”ν•μ„Έμ”.</p>
        
        <div class="form-group">
          <label class="form-label" for="secretKeyInput">λ€μΉ­ν‚¤(ν…μ¤νΈ λλ” Base64)</label>
          <textarea id="secretKeyInput" class="form-textarea" rows="3" placeholder="λ€μΉ­ν‚¤ μ…λ ¥ λλ” Base64"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label" for="pubKeyInput">κ³µκ°ν‚¤ (PEM λλ” Base64)</label>
          <textarea id="pubKeyInput" class="form-textarea" rows="6" placeholder="μ—¬κΈ°μ— κ³µκ°ν‚¤ λ¶™μ—¬λ„£κΈ° (ν‚¤ μƒμ„± ν›„ λ³µμ‚¬ κ°€λ¥)"></textarea>
        </div>

        <button class="btn btn-success" onclick="encryptSecretKey()">
          <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
            <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
          </svg>
          λ€μΉ­ν‚¤ μ•”νΈν™”
        </button>

        <div class="output-section" id="encryptOutput" style="display: none;">
          <div class="output-header">
            <span class="output-label green">μ•”νΈν™”λ λ€μΉ­ν‚¤</span>
            <button class="copy-btn green" onclick="copyToClipboard('encryptedSecretKeyOutput')">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
              λ³µμ‚¬
            </button>
          </div>
          <pre class="output-box green" id="encryptedSecretKeyOutput"></pre>
        </div>
      </div>
    </div>

    <!-- λ€μΉ­ν‚¤ λ³µνΈν™” -->
    <div class="card">
      <div class="card-header purple">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
        </svg>
        λ€μΉ­ν‚¤ λ³µνΈν™” λ„κµ¬
      </div>
      <div class="card-content">
        <p class="description">λΉ„λ°€λ²νΈλ΅ λ³΄νΈλ κ°μΈν‚¤(Base64)μ™€ μ•”νΈν™”λ λ€μΉ­ν‚¤(Base64)λ¥Ό μ…λ ¥ν•μ„Έμ”.</p>
        
        <div class="form-group">
          <label class="form-label" for="password">
            <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor" style="display: inline; margin-right: 6px;">
              <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
            </svg>
            λΉ„λ°€λ²νΈ
          </label>
          <div class="input-wrapper">
            <input type="password" id="password" class="form-input" placeholder="κ°μΈν‚¤ λΉ„λ°€λ²νΈ μ…λ ¥" />
            <button type="button" class="password-toggle" onclick="togglePassword('password')">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="privateKeyInput">μ•”νΈν™”λ κ°μΈν‚¤ (Base64)</label>
          <textarea id="privateKeyInput" class="form-textarea" rows="4" placeholder="μ•”νΈν™”λ κ°μΈν‚¤ λ¶™μ—¬λ„£κΈ°"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label" for="encryptedKey">μ•”νΈν™”λ λ€μΉ­ν‚¤ (Base64)</label>
          <textarea id="encryptedKey" class="form-textarea" rows="4" placeholder="μ•”νΈν™”λ λ€μΉ­ν‚¤ λ¶™μ—¬λ„£κΈ°"></textarea>
        </div>

        <button class="btn btn-purple" onclick="decryptKey()">
          <svg class="icon-sm" viewBox="0 0 24 24" fill="currentColor">
            <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
          </svg>
          λ€μΉ­ν‚¤ λ³µνΈν™”
        </button>

        <div class="output-section" id="decryptOutput" style="display: none;">
          <div class="output-header">
            <span class="output-label purple">λ³µνΈν™”λ λ€μΉ­ν‚¤</span>
          </div>
          <pre class="output-box purple" id="output"></pre>
        </div>
      </div>
    </div>

    <!-- ν‘Έν„° -->
    <div class="footer">
      <p>π” μ•”νΈν™” μ‘μ—… μ‚¬μ΄νΈ</p>
    </div>
  </div>

  <script>
    // λΉ„λ°€λ²νΈ ν‘μ‹/μ¨κΉ€ ν† κΈ€
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
      input.setAttribute('type', type);
    }

    // PEM μΈμ½”λ”© ν•¨μ
    function pemEncode(buffer, label) {
      const base64 = btoa(String.fromCharCode(...new Uint8Array(buffer)));
      const formatted = base64.match(/.{1,64}/g).join('\n');
      return formatted;
    }

    // PEM λ””μ½”λ”©: PEM -> ArrayBuffer
    function pemToArrayBuffer(pem) {
      const b64 = pem.replace(/-----[^-]+-----/g, '').replace(/\s/g, '');
      const binary = atob(b64);
      const len = binary.length;
      const buffer = new Uint8Array(len);
      for(let i=0; i<len; i++) {
        buffer[i] = binary.charCodeAt(i);
      }
      return buffer.buffer;
    }

    // κ°μΈν‚¤ μ•”νΈν™” (AES-GCM) λΉ„λ°€λ²νΈ μ λ„ ν‚¤ μƒμ„±
    async function getPasswordKey(password, salt) {
      const enc = new TextEncoder();
      const pwKey = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]);
      return crypto.subtle.deriveKey(
        { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
        pwKey,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
      );
    }

    // ν‚¤μ μƒμ„± + κ°μΈν‚¤ μ•”νΈν™”
    async function generateKeyPair() {
      const password = document.getElementById('genPassword').value;
      if(!password) {
        alert("λΉ„λ°€λ²νΈλ¥Ό μ…λ ¥ν•μ„Έμ”.");
        return;
      }

      try {
        const keyPair = await crypto.subtle.generateKey(
          { name: "RSA-OAEP", modulusLength: 2048, publicExponent: new Uint8Array([1,0,1]), hash: "SHA-256" },
          true,
          ["encrypt", "decrypt"]
        );

        const publicKey = await crypto.subtle.exportKey("spki", keyPair.publicKey);
        const privateKey = await crypto.subtle.exportKey("pkcs8", keyPair.privateKey);

        const salt = crypto.getRandomValues(new Uint8Array(16));
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const wrappingKey = await getPasswordKey(password, salt);
        const encryptedPrivateKey = await crypto.subtle.encrypt(
          { name: "AES-GCM", iv }, wrappingKey, privateKey);

        // κ°μΈν‚¤ μ•”νΈν™” λ°μ΄ν„°: iv(12) + salt(16) + μ•”νΈλ¬Έ
        const combined = new Uint8Array(iv.length + salt.length + encryptedPrivateKey.byteLength);
        combined.set(iv, 0);
        combined.set(salt, iv.length);
        combined.set(new Uint8Array(encryptedPrivateKey), iv.length + salt.length);

        document.getElementById('publicKeyPem').textContent = pemEncode(publicKey, "PUBLIC KEY");
        document.getElementById('encryptedPrivateKey').textContent = btoa(String.fromCharCode(...combined));
        document.getElementById('keyGenOutput').style.display = 'block';
      } catch (error) {
        alert("ν‚¤ μƒμ„± μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.");
        console.error(error);
      }
    }

    // κ³µκ°ν‚¤λ΅ λ€μΉ­ν‚¤ μ•”νΈν™”
    async function encryptSecretKey() {
      const secretKeyStr = document.getElementById('secretKeyInput').value.trim();
      const pubKeyPem = document.getElementById('pubKeyInput').value.trim();
      
      if (!secretKeyStr || !pubKeyPem) {
        alert("λ€μΉ­ν‚¤μ™€ κ³µκ°ν‚¤λ¥Ό λ¨λ‘ μ…λ ¥ν•μ„Έμ”.");
        return;
      }

      try {
        // κ³µκ°ν‚¤ λ¶λ¬μ¤κΈ°
        const pubKeyBuffer = pemToArrayBuffer(pubKeyPem);
        const publicKey = await crypto.subtle.importKey(
          "spki",
          pubKeyBuffer,
          { name: "RSA-OAEP", hash: "SHA-256" },
          false,
          ["encrypt"]
        );

        // λ€μΉ­ν‚¤λ¥Ό Uint8Arrayλ΅ λ³€ν™ (ν‰λ¬ΈμΌλ΅λ§ μ²λ¦¬)
        const secretKeyBytes = new TextEncoder().encode(secretKeyStr);
        const encrypted = await crypto.subtle.encrypt(
          { name: "RSA-OAEP" },
          publicKey,
          secretKeyBytes
        );

        console.log("μ•”νΈν™”ν•  λ€μΉ­ν‚¤ λ°”μ΄νΈ:", secretKeyBytes);
        const encBase64 = btoa(String.fromCharCode(...new Uint8Array(encrypted)));
        document.getElementById('encryptedSecretKeyOutput').textContent = encBase64;
        document.getElementById('encryptOutput').style.display = 'block';
      } catch (e) {
        alert("λ€μΉ­ν‚¤ μ•”νΈν™” μ¤‘ μ¤λ¥ λ°μƒ: " + e.message);
        console.error(e);
      }
    }

    // λ€μΉ­ν‚¤ λ³µνΈν™”
    async function decryptKey() {
      const encryptedBase64 = document.getElementById('encryptedKey').value.trim();
      const encryptedPrivateBase64 = document.getElementById('privateKeyInput').value.trim();
      const password = document.getElementById('password').value;
      
      if (!encryptedBase64 || !encryptedPrivateBase64 || !password) {
        alert('λ¨λ“  μ…λ ¥μ„ ν™•μΈν•΄μ£Όμ„Έμ”.');
        return;
      }

      try {
        const encryptedPrivateBytes = Uint8Array.from(atob(encryptedPrivateBase64), c => c.charCodeAt(0));
        const iv = encryptedPrivateBytes.slice(0, 12);
        const salt = encryptedPrivateBytes.slice(12, 28);
        const ciphertext = encryptedPrivateBytes.slice(28);

        const enc = new TextEncoder();
        const pwKey = await crypto.subtle.importKey("raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]);
        const wrappingKey = await crypto.subtle.deriveKey(
          { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
          pwKey,
          { name: "AES-GCM", length: 256 },
          false,
          ["decrypt"]
        );

        const pkcs8 = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, wrappingKey, ciphertext);
        const privateKey = await crypto.subtle.importKey(
          "pkcs8",
          pkcs8,
          { name: "RSA-OAEP", hash: "SHA-256" },
          false,
          ["decrypt"]
        );

        const encryptedKey = Uint8Array.from(atob(encryptedBase64), c => c.charCodeAt(0));
        const decrypted = await crypto.subtle.decrypt({ name: "RSA-OAEP" }, privateKey, encryptedKey);

        const decoder = new TextDecoder();
        const text = decoder.decode(decrypted);

        console.log("λ³µνΈν™”λ raw buffer:", new Uint8Array(decrypted));
        console.log("λ””μ½”λ”©λ ν…μ¤νΈ:", text);
        document.getElementById('output').textContent = text;
        document.getElementById('decryptOutput').style.display = 'block';
      } catch (err) {
        console.error(err);
        alert('λ³µνΈν™” μ‹¤ν¨. μ…λ ¥μ„ λ‹¤μ‹ ν™•μΈν•μ„Έμ”.');
      }
    }

    // ν΄λ¦½λ³΄λ“ λ³µμ‚¬ ν•¨μ
    function copyToClipboard(id) {
      // const text = document.getElementById(id).textContent;
      // if (!text) {
      //   alert("λ³µμ‚¬ν•  λ‚΄μ©μ΄ μ—†μµλ‹λ‹¤.");
      //   return;
      // }
      // navigator.clipboard.writeText(text).then(() => {
      //   alert("λ³µμ‚¬λμ—μµλ‹λ‹¤!");
      // }).catch(() => {
      //   alert("λ³µμ‚¬μ— μ‹¤ν¨ν–μµλ‹λ‹¤.");
      // });
    
      const text = document.getElementById(id).textContent;
      if (!text) {
        alert("λ³µμ‚¬ν•  λ‚΄μ©μ΄ μ—†μµλ‹λ‹¤.");
        return;
      }

      navigator.clipboard.writeText(text).then(() => {
        alert("λ³µμ‚¬λμ—μµλ‹λ‹¤!");
      }).catch(() => {
        // λ¨λ°”μΌ ν™κ²½ λ“± νΈν™ μ• λ  λ• fallback
        const textarea = document.createElement("textarea");
        textarea.value = text;
        textarea.style.position = "fixed"; // ν™”λ©΄ λ°”κΉ¥ ν΄λ¦­ λ°©μ§€
        textarea.style.top = "-1000px";
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();
        try {
          document.execCommand("copy");
          alert("λ³µμ‚¬λμ—μµλ‹λ‹¤!");
        } catch (err) {
          alert("λ³µμ‚¬μ— μ‹¤ν¨ν–μµλ‹λ‹¤. ν…μ¤νΈλ¥Ό κΈΈκ² λλ¬ λ³µμ‚¬ν•΄μ£Όμ„Έμ”.");
        }
        document.body.removeChild(textarea);
      });
    }
  </script>
</body>
</html>